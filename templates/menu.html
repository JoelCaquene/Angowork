{% extends "base.html" %}
{% load static %}

{% block title %}ANGOWORK - Dashboard Profissional{% endblock %}

{% block content %}
{# 1. MODAL DE BOAS-VINDAS PERSONALIZADO #}
<div id="welcomeModal" class="modal-overlay">
    <div class="modal-content-custom glass-effect animate-in">
        <div class="modal-header-custom">
            <h2 class="modal-logo">ANGOWORK</h2>
            <p class="modal-subtitle">Informativo Oficial</p>
        </div>
        
        <div class="modal-body-scroll">
            <div class="info-item">
                <i class="fas fa-calendar-alt"></i>
                <p><strong>Horário:</strong> Segunda a Sábado (Domingo não prestamos serviços).</p>
            </div>
            <div class="info-item">
                <i class="fas fa-clock"></i>
                <p><strong>Atendimento:</strong> 08:30 às 21:00.</p>
            </div>
            
            <hr class="modal-divider">
            
            <div class="modal-text-content">
                <p>Não somos uma plataforma de investimento, mas sim uma <strong>empresa de rendimento online</strong>.</p>
                <p>O seu depósito servirá de garantia do seu compromisso com a empresa.</p>
                <p>Após <strong>1 ano de serviço</strong> contínuo, o seu valor de garantia será totalmente reembolsado.</p>
            </div>

            <a href="{{ whatsapp_link }}" target="_blank" class="btn-whatsapp-custom">
                <div class="whatsapp-icon-animate">
                    <i class="fab fa-whatsapp"></i>
                </div>
                <span>ENTRAR NO GRUPO GERAL</span>
            </a>
        </div>

        <div class="modal-footer-custom">
            <button class="btn-close-modal-new" onclick="closeModal()">CONCORDAR E CONTINUAR</button>
        </div>
    </div>
</div>

<div class="forex-dashboard">
    
    {# TOPO SUPERIOR #}
    <div class="top-header">
        <a href="{% url 'logout' %}" class="btn-sair-topo">SAIR</a>
        <h1 class="logo-angowork">ANGOWORK</h1>
        <div style="width: 50px;"></div>
    </div>

    {# PAINEL DE INDICADORES (6 INDICADORES) #}
    <div class="indicators-grid glass-effect">
        <div class="indicator-sq">
            <span class="ind-label">Função</span>
            <span class="ind-value">{% if active_level %}{{ active_level.level.name }}{% else %}Função 0{% endif %}</span>
        </div>
        <div class="indicator-sq">
            <span class="ind-label">Saldo</span>
            <span class="ind-value">KZ {{ user.available_balance|default:"0.00" }}</span>
        </div>
        <div class="indicator-sq">
            <span class="ind-label">Garantia</span>
            <span class="ind-value">KZ {{ approved_deposit_total|default:"0" }}</span>
        </div>
        
        <div class="indicator-sq">
            <span class="ind-label">HOJE</span>
            <span class="ind-value">KZ {{ daily_income|default:"0.00" }}</span>
        </div>
        <div class="indicator-sq">
            <span class="ind-label">Subsídios</span>
            <span class="ind-value">KZ {{ user.subsidy_balance|default:"0.00" }}</span>
        </div>
        <div class="indicator-sq">
            <span class="ind-label">SAQUES APROVADOS</span>
            <span class="ind-value">KZ {{ total_withdrawals|default:"0.00" }}</span>
        </div>
    </div>

    {# GRID DE AÇÕES #}
    <div class="action-grid glass-effect">
        <a href="{% url 'deposito' %}" class="action-item">
            <div class="icon-box-dark"><i class="fas fa-piggy-bank"></i></div>
            <span>Garantia</span>
        </a>
        <a href="{% url 'tarefa' %}" class="action-item">
            <div class="icon-box-dark"><i class="fas fa-briefcase"></i></div>
            <span>Actividade</span>
        </a>
        <a href="{% url 'nivel' %}" class="action-item">
            <div class="icon-box-dark"><i class="fas fa-crown"></i></div>
            <span>Função</span>
        </a>
        <a href="{% url 'sobre' %}" class="action-item">
            <div class="icon-box-dark"><i class="fas fa-bullhorn"></i></div>
            <span>Tutoria</span>
        </a>
        <a href="{% url 'saque' %}" class="action-item">
            <div class="icon-box-dark"><i class="fas fa-hand-holding-dollar"></i></div>
            <span>ATM</span>
        </a>
    </div>

    <div 
        </p>.</div>
    </div>
{# SEÇÃO DE APOIO CLIENTE #}
    <div class="licenca-container" style="text-align: center; padding: 20px;">
        <img src="{% static 'images/logo_isj.png' %}" alt="Logo ISJ" class="isj-logo" style="max-width: 80px; margin-bottom: 10px;">
        
        <p class="licenca-texto" style="font-weight: bold; color: #25D366; margin-bottom: 15px;">
            <i class="fab fa-whatsapp"></i> SUPORTE WHATSAPP
        </p>

        <p style="margin-bottom: 10px;">
            <a href="https://wa.me/15488715435" target="_blank" style="text-decoration: none; color: inherit; font-weight: 600;">
                <i class="fas fa-external-link-alt" style="font-size: 0.8rem; opacity: 0.7;"></i> +1 (548) 871-5435
            </a>
        </p>

        <p style="margin-bottom: 10px;">
            <a href="https://wa.me/15488716128" target="_blank" style="text-decoration: none; color: inherit; font-weight: 600;">
                <i class="fas fa-external-link-alt" style="font-size: 0.8rem; opacity: 0.7;"></i> +1 (548) 871-6128
            </a>
        </p>

        <p style="margin-bottom: 10px;">
            <a href="https://wa.me/12495282836" target="_blank" style="text-decoration: none; color: inherit; font-weight: 600;">
                <i class="fas fa-external-link-alt" style="font-size: 0.8rem; opacity: 0.7;"></i> +1 (249) 528-2836
            </a>
        </p>
    </div>

    {# BARRA INFERIOR #}
    <div class="bottom-nav glass-effect">
        <a href="{% url 'perfil' %}" class="action-item">
            <div class="icon-box-black"><i class="fas fa-university"></i></div>
            <span>IBAN</span>
        </a>
        <a href="{% url 'nivel' %}" class="action-item">
            <div class="icon-box-black"><i class="fas fa-crown"></i></div>
            <span>Função</span>
        </a>
        <a href="{% url 'roleta' %}" class="action-item">
            <div class="icon-box-black btn-sorteio-anim"><i class="fas fa-dharmachakra"></i></div>
            <span style="color: #ffcc00; font-weight: bold;">Sorteio</span>
        </a>
        <a href="{% url 'equipa' %}" class="action-item">
            <div class="icon-box-black"><i class="fas fa-users"></i></div>
            <span>Afiliados</span>
        </a>
        <a href="{% url 'change_password' %}" class="action-item">
            <div class="icon-box-black"><i class="fas fa-user-shield"></i></div>
            <span>Senha</span>
        </a>
    </div>

</div>

<style>
    :root {
        --text-white: #ffffff;
        --glass-bg: rgba(255, 255, 255, 0.08);
        --blue-dark: #002d5e;
        --black-pure: #000000;
        --whatsapp-green: #25d366;
    }

    html, body {
        margin: 0; padding: 0;
        background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), url("{% static 'background_cad.jpg' %}") no-repeat center center fixed;
        background-size: cover;
        font-family: 'Poppins', sans-serif;
        color: white;
    }

    .forex-dashboard { width: 100%; max-width: 500px; margin: 0 auto; padding-bottom: 110px; }

    /* --- MODAL STYLE --- */
    .modal-overlay { 
        position: fixed; inset: 0; background: rgba(0,0,0,0.9); 
        display: flex; justify-content: center; align-items: center; 
        z-index: 10000; backdrop-filter: blur(8px); 
    }
    .modal-content-custom { 
        width: 85%; max-width: 320px; max-height: 80vh; 
        background: rgba(20, 20, 20, 0.95);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 25px; display: flex; flex-direction: column; overflow: hidden;
    }
    .animate-in { animation: modalShow 0.4s ease-out; }
    @keyframes modalShow { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }

    .modal-header-custom { padding: 20px 15px 10px; text-align: center; }
    .modal-logo { font-size: 20px; font-weight: 900; letter-spacing: 2px; margin: 0; }
    .modal-subtitle { font-size: 10px; color: #3b82f6; font-weight: bold; text-transform: uppercase; margin-top: 5px; }

    .modal-body-scroll { padding: 15px 20px; overflow-y: auto; flex: 1; }
    .modal-body-scroll::-webkit-scrollbar { width: 3px; }
    .modal-body-scroll::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }

    .info-item { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; }
    .info-item i { color: #3b82f6; font-size: 14px; }
    .info-item p { font-size: 12px; margin: 0; color: #ddd; }

    .modal-divider { border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 15px 0; }
    .modal-text-content p { font-size: 12px; line-height: 1.6; color: #bbb; margin-bottom: 12px; text-align: center; }

    /* WHATSAPP PERSONALIZADO */
    .btn-whatsapp-custom { 
        background: var(--whatsapp-green); color: white; text-decoration: none; 
        padding: 12px; border-radius: 15px; display: flex; justify-content: center; 
        align-items: center; gap: 10px; font-size: 11px; font-weight: bold; margin-top: 10px;
        box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
    }
    .whatsapp-icon-animate {
        font-size: 18px;
        animation: pulse-green 2s infinite;
    }
    @keyframes pulse-green {
        0% { transform: scale(1); text-shadow: 0 0 0 rgba(255,255,255, 0.7); }
        70% { transform: scale(1.2); text-shadow: 0 0 10px rgba(255,255,255, 0); }
        100% { transform: scale(1); text-shadow: 0 0 0 rgba(255,255,255, 0); }
    }

    .btn-close-modal-new { 
        width: 100%; border: none; background: #fff; color: #000; 
        padding: 14px; font-size: 12px; font-weight: 800; cursor: pointer;
    }

    /* --- DASHBOARD STYLE --- */
    .top-header { display: flex; justify-content: space-between; align-items: center; padding: 15px; }
    .logo-angowork { font-weight: 900; font-size: 22px; color: #fff; }
    .btn-sair-topo { background: #ff4444; color: white; padding: 5px 12px; border-radius: 6px; text-decoration: none; font-size: 10px; font-weight: bold; }

    .indicators-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin: 10px; padding: 12px; border-radius: 15px; }
    .indicator-sq { display: flex; flex-direction: column; align-items: center; background: rgba(255,255,255,0.05); padding: 12px 2px; border-radius: 10px; }
    .ind-label { font-size: 7px; color: #aaa; text-transform: uppercase; margin-bottom: 4px; text-align: center; }
    .ind-value { font-size: 9px; font-weight: bold; color: #fff; }

    .action-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin: 15px 10px; padding: 15px 5px; border-radius: 15px; }
    .icon-box-dark { width: 42px; height: 42px; background: var(--blue-dark); color: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 6px; font-size: 18px; }

    .licenca-container { margin: 20px 15px; padding: 15px; text-align: center; background: rgba(0,0,0,0.4); border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); }
    .isj-logo { width: 70px; margin-bottom: 10px; opacity: 0.8; }
    .licenca-texto { font-size: 9px; color: #aaa; line-height: 1.4; margin: 0; }

    .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; max-width: 500px; margin: 0 auto; display: grid; grid-template-columns: repeat(5, 1fr); padding: 10px 5px; background: #000 !important; z-index: 999; border-radius: 20px 20px 0 0; }
    .icon-box-black { width: 40px; height: 40px; background: #111; color: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-bottom: 5px; font-size: 16px; border: 1px solid #222; }

    .btn-sorteio-anim i { color: #ffcc00; animation: spin-slow 3s linear infinite; }
    @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    .action-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: white; }
    .action-item span { font-size: 8px; font-weight: 500; text-transform: uppercase; }

    .glass-effect { background: var(--glass-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.1); }
</style>

<script>
    function closeModal() {
        const modal = document.getElementById('welcomeModal');
        modal.style.transition = 'opacity 0.3s ease';
        modal.style.opacity = '0';
        setTimeout(() => { modal.style.display = 'none'; }, 300);
    }
</script>
{% endblock %}
